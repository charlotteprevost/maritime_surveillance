<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
  <title>Maritime Surveillance: SAR Detections & Dark Traffic Analysis</title>
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover" />
  <meta name="description"
    content="Interactive map visualizing dark vessel detections using SAR satellite data and AIS gap analysis. Monitor Exclusive Economic Zones and analyze maritime traffic patterns." />
  <meta name="keywords"
    content="maritime surveillance, dark vessels, SAR detections, AIS, Exclusive Economic Zone, ocean monitoring, vessel tracking, satellite radar" />

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Maritime Surveillance: SAR Detections & Dark Traffic Analysis" />
  <meta property="og:description"
    content="Interactive map visualizing dark vessel detections using SAR satellite data and AIS gap analysis." />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Maritime Surveillance: SAR Detections & Dark Traffic Analysis" />
  <meta name="twitter:description"
    content="Interactive map visualizing dark vessel detections using SAR satellite data and AIS gap analysis." />

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <link rel="stylesheet" href="css/style.css" />
</head>

<body>
  <header>
    <div class="header-toggles" aria-label="Header controls">
      <button class="header-toggle header-toggle--filters" id="sidebar-toggle" title="Show filters"
        aria-label="Show filters" aria-controls="sidebar" aria-expanded="false">
        <span class="toggle-icon" aria-hidden="true">&#x27F1;</span>
      </button>
    </div>
    <div class="header-content">
      <h1>Maritime Surveillance</h1>
      <p>SAR Detections & Dark Traffic</p>
    </div>
  </header>

  <main class="main-layout">
    <!-- Sidebar backdrop for mobile -->
    <div class="sidebar-backdrop" id="sidebar-backdrop"></div>

    <!-- Sidebar (slides down from below header) -->
    <aside class="sidebar collapsed" id="sidebar">
      <div class="sidebar-content">
        <button id="about-toggle" aria-controls="about-container" aria-expanded="false">
          <span class="about-toggle-icon" aria-hidden="true">☰</span>
          <span class="about-toggle-text">Read before you start</span>
        </button>

        <div id="about-container" class="collapsed">
          <div class="about-accordion">
            <div class="about-accordion-item collapsed">
              <button class="about-accordion-header" data-section="usage">
                <span>How to Use</span>
                <span class="accordion-icon">▼</span>
              </button>
              <div class="about-accordion-content">
                <div class="about-data">
                  <h3>How to Use This Map</h3>
                  <ol>
                    <li>Select one or more Exclusive Economic Zone(s)</li>
                    <li>Choose a valid date range (earliest: 2017-01-01; latest: 7 days ago)</li>
                    <li>Click “Apply Filters”</li>
                    <li>Use the Legend toggles to show/hide layers</li>
                  </ol>
                  <h3 id="data-availability">Data Availability</h3>
                  <p>
                    Global Fishing Watch SAR data is usually available with a short delay. If your query looks “recent”
                    or too narrow, it’s totally normal to see zero results.
                  </p>
                  <ul>
                    <li>Latest available end date is <strong>~7 days ago</strong>.</li>
                    <li>For best results, try ending <strong>~2 weeks ago</strong> (and/or widen the range).</li>
                    <li>Some EEZs/time windows genuinely have no detections — that’s a real outcome.</li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="about-accordion-item collapsed">
              <button class="about-accordion-header" data-section="sources-methods">
                <span>Data Sources & Methods</span>
                <span class="accordion-icon">▼</span>
              </button>
              <div class="about-accordion-content">
                <div class="about-data">
                  <h3>Data Sources</h3>
                  <ul>
                    <li>
                      <strong>Global Fishing Watch (GFW)</strong> SAR detections (Sentinel‑1). These detections are
                      <em>points only</em> and generally do not include vessel identity.
                    </li>
                    <li>
                      <strong>EEZ boundaries</strong> are used for geographic context and filtering.
                    </li>
                  </ul>

                  <h3>Links</h3>
                  <ul>
                    <li><a href="https://globalfishingwatch.org/our-apis" target="_blank" rel="noopener noreferrer">GFW
                        APIs</a></li>
                  </ul>

                  <h3>Route Prediction (best‑effort)</h3>
                  <p>
                    When enabled, routes are inferred by connecting SAR detections that are close in time and distance.
                    These are <strong>not confirmed tracks</strong>—they’re a visualization aid for exploring patterns.
                  </p>

                  <h3>Research & References</h3>
                  <ul>
                    <li>
                      <a href="https://www.esa.int/Applications/Observing_the_Earth/Copernicus/Sentinel-1"
                        target="_blank" rel="noopener noreferrer">ESA Sentinel‑1 mission</a>
                    </li>
                    <li>
                      <a href="https://doi.org/10.1126/science.aao5646" target="_blank"
                        rel="noopener noreferrer">Kroodsma
                        et al. (2018) — Tracking the global footprint of fisheries (Science)</a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        <form class="filters-panel" aria-label="Map filters">
          <div class="controls">
            <div class="filter-group">
              <label for="eez-search" class="filter-label">
                <span>Exclusive Economic Zones</span>
              </label>

              <div class="eez-search-container">
                <div class="eez-search-wrapper">
                  <label for="eez-search" class="sr-only">Search Exclusive Economic Zones</label>
                  <input type="search" id="eez-search" name="eez-search" placeholder="Search EEZs..." autocomplete="off"
                    aria-label="Search Exclusive Economic Zones" />
                  <button type="button" id="eez-search-clear" class="search-clear-btn" title="Clear search"
                    aria-label="Clear search" aria-controls="eez-search eez-select">×</button>
                </div>
              </div>

              <label for="eez-select" class="sr-only">Select Exclusive Economic Zones to monitor</label>
              <select id="eez-select" name="eez-select" multiple size="5"
                aria-label="Exclusive Economic Zones selection" aria-required="true">
                <option value="" disabled>Loading EEZs…</option>
              </select>
              <span id="eez-error" class="date-range-error" aria-live="polite" style="display: none;">select at least
                one EEZ</span>

              <div id="selected-eez-list" class="selected-eez-list" aria-label="Selected Exclusive Economic Zones"
                style="display: none;"></div>
            </div>

            <div class="filter-group">
              <label for="start" class="filter-label">
                <span>Date Range</span>
                <span class="filter-description">
                  Earliest: 2017-01-01, Latest: <span id="latest-date-text">7 days ago</span><br />
                  <span class="date-hint">Tip: try ending ~2 weeks ago for best results.</span>
                </span>
              </label>

              <div class="date-presets" role="group" aria-label="Quick date presets">
                <button type="button" class="date-preset-btn" data-days="7">Last 7 days</button>
                <button type="button" class="date-preset-btn" data-days="30">Last 30 days</button>
                <button type="button" class="date-preset-btn" data-days="365">Last year</button>
              </div>

              <div class="date-inputs" role="group" aria-label="Date range selection">
                <div class="date-input-wrapper">
                  <label for="start" class="sr-only">Start date</label>
                  <input type="date" id="start" name="start" aria-label="Start date" aria-required="true" />
                </div>
                <span class="date-separator" aria-hidden="true">to</span>
                <div class="date-input-wrapper">
                  <label for="end" class="sr-only">End date</label>
                  <input type="date" id="end" name="end" aria-label="End date" aria-required="true" />
                </div>
              </div>
              <span id="date-range-error" class="date-range-error" aria-live="polite" style="display: none;">invalid
                date
                range</span>
            </div>

            <button type="button" id="applyFilters" aria-label="Apply filters">
              Apply Filters
            </button>

            <div id="empty-state" class="empty-state hidden" role="status" aria-live="polite">
              <div class="empty-title">No detections found.</div>
              <div class="empty-body">Try adjusting your filters (different EEZ or a wider date range).</div>
              <a href="#" id="data-availability-link" class="empty-link">Learn more about data availability</a>
            </div>

            <section id="summary-stats" class="hidden">
              <h3>Analytics</h3>
              <div class="stats-grid">
                <div class="stat-card">
                  <div class="stat-value" id="stat-sar-detections">0</div>
                  <div class="stat-label">SAR Detections</div>
                </div>
                <div class="stat-card">
                  <div class="stat-value" id="stat-eez-count">0</div>
                  <div class="stat-label">EEZs</div>
                </div>
                <div class="stat-card">
                  <div class="stat-value" id="stat-clusters">0</div>
                  <div class="stat-label" id="stat-clusters-label">Dark Traffic Clusters</div>
                </div>
              </div>
            </section>
          </div>
        </form>
      </div>
    </aside>

    <!-- Right Map Container -->
    <div class="map-container">
      <div id="map"></div>
    </div>
  </main>

  <div id="loading-spinner" class="hidden">
    <div class="spinner-text">Loading data...</div>
    <div id="loading-detail" class="spinner-detail" aria-live="polite"></div>
    <div id="progress-bar">
      <div id="progress-bar-fill"></div>
    </div>
    <div id="loading-progress-text" class="spinner-progress" aria-live="polite">0%</div>
    <button type="button" id="cancel-loading" class="spinner-cancel" aria-label="Cancel loading">Cancel</button>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <script src="main.js" type="module"></script>
</body>

</html>